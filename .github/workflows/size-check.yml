name: Package Size Check

on:
  pull_request:
    branches: [ main, develop ]

jobs:
  size:
    name: Check Package Size
    runs-on: windows-latest
    
    steps:
    - uses: actions/checkout@v6
    
    - name: Setup Node.js
      uses: actions/setup-node@v6
      with:
        node-version: '22'
        cache: 'npm'
    
    - name: Install dependencies
      run: npm ci
    
    - name: Build
      run: npm run build
    
    - name: Check package size
      run: |
        npm pack
        $file = Get-Item *.tgz
        $sizeBytes = $file.Length
        $sizeMB = [math]::Round($sizeBytes / 1MB, 2)
        Write-Host "Package size: $sizeMB MB ($sizeBytes bytes)"
        
        # Check if size is reasonable (under 6MB)
        $maxSize = 6MB
        
        if ($sizeBytes -gt $maxSize) {
          Write-Host "Warning: Package size ($sizeMB MB) exceeds 6MB"
          exit 1
        }
        
        Write-Host "âœ… Package size is acceptable: $sizeMB MB"
      shell: pwsh
    
    - name: List package contents
      run: |
        $file = Get-Item *.tgz
        tar -tzf $file.Name | Select-Object -First 50
      shell: pwsh
